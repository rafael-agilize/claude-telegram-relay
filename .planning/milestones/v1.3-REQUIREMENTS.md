# REQUIREMENTS.md â€” v1.3: Smart Memory (Archived)

## Origin

Upstream commit [fced316](https://github.com/rafael-agilize/claude-telegram-relay/commit/fced3162c65657635e97164f7ba4f519e145283a): "Add Supabase memory system with semantic search". Adapted to our v2 schema (threaded conversations, three-layer memory, cron/heartbeat).

## Scope

Evolve the flat `global_memory` system into a typed memory with goals tracking, rename intent tags to upstream convention, and add semantic search via OpenAI embeddings in Supabase Edge Functions.

## Functional Requirements

| Req | Description | Status | Phase |
|-----|-------------|--------|-------|
| R1 | Typed Memory System | **Complete** | 14 |
| R2 | Goals Lifecycle | **Complete** | 15 |
| R3 | Rename LEARN -> REMEMBER Intent | **Complete** | 15 |
| R4 | Add GOAL Intent | **Complete** | 15 |
| R5 | Add DONE Intent | **Complete** | 15 |
| R6 | Keep FORGET Intent | **Complete** | 15 |
| R7 | Auto-Embedding Edge Function | **Complete** | 16 |
| R8 | Semantic Search Edge Function | **Complete** | 16 |
| R9 | Semantic Memory in Prompt Context | **Complete** | 16 |
| R10 | Graceful Degradation | **Complete** | 16 |
| R11 | Updated /memory Command | **Complete** | 15 |
| R12 | Database Migration | **Complete** | 14 |

## Non-Functional Requirements

| Req | Description | Status | Phase |
|-----|-------------|--------|-------|
| NF1 | No New Env Vars in Relay | **Complete** | 16 |
| NF2 | Single-File Architecture Preserved | **Complete** | 16 |
| NF3 | Backward Compatible | **Complete** | 14 |

**Coverage: 15/15 (100%)**

## Success Criteria

- [x] `[REMEMBER:]` creates typed fact entries
- [x] `[GOAL:]` creates goals with optional deadlines
- [x] `[DONE:]` completes matching goals
- [x] `/memory` shows facts and goals separately
- [x] Edge Functions deploy and auto-embed on INSERT
- [x] Semantic search returns relevant memories for queries
- [x] `buildPrompt()` includes semantically relevant context
- [x] System works fully even without Edge Functions deployed
- [x] Existing global_memory data preserved after migration

## Out of Scope (Preserved)

- Semantic search on `thread_messages` (decision: memory-only for now)
- Embedding provider alternatives (OpenAI text-embedding-3-small chosen)
- Memory management UI (Telegram commands sufficient)
- Auto-cleanup of old/stale memories
